## 秒杀架构设计
### 前言
秒杀业务是电商平台常规的营销活动,比如说京东秒杀，就是一种定时定量秒杀，在规定的时间内，无论商品是否秒杀完毕，该场次的秒杀活动都会结束。这种秒杀，对时间不是特别严格，只要下手快点，秒中的概率还是比较大的。

### 业务特点
+ 瞬时并发量大
+ 库存少

### 技术难点
1. 如何防止超卖
2. 如何防止DB层挂掉
3. 对现有业务冲击


### 架构设计思想
下单时减库存
方案一 数据库加锁 悲观锁乐观锁

把商品库存放到redis里,每次来用户请求decr一下,decr完就返回已售罄
```
select num from goods for update
if($num) {
    //生成订单
}else{
}
```
方案二、redis锁
把商品库存放到redis里,每次来用户请求decr一下,decr完就返回已售罄
```
$cnt = $redis->decr($key)
if($cnt) {
    //生成订单
}else{

}
```

方案三、队列 进行流量削峰
```
$redis->push($key);
$cnt = $redis->lpop($key);
if($cnt) {
    //生成订单
}else{

}
```

架构:
1.客户端层
    + 热点数据页面静态化
2.负载均衡层
    如果需要 负载均衡层可以感知
3.服务接口层
4.cache层
5.数据存储层


[参考1](https://blog.csdn.net/qq_42806915/article/details/82666254)
[参考2](https://blog.51cto.com/13527416/2085258)